<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Edit Modal</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../styles/addCard.css" />
</head>
<body>
    <h1>Debug Edit Modal</h1>
    <button onclick="testEditModal()">Load Edit Modal</button>
    <div id="modalContainer"></div>
    
    <script>
    async function testEditModal() {
        try {
            const modalContainer = document.getElementById('modalContainer');
            const res = await fetch('./modals/editCard.html');
            const html = await res.text();
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const modal = doc.querySelector('.modal-overlay');
            
            if (!modal) {
                console.error('Modal not found');
                return;
            }
            
            modalContainer.innerHTML = '';
            modalContainer.appendChild(modal);
            modal.classList.add('active');
            
            // Set test data
            modal.dataset.cardId = '1';
            modal.querySelector('#editCardCategory').value = 'Personal';
            modal.querySelector('#editFName').value = 'Test';
            modal.querySelector('#editLname').value = 'User';
            modal.querySelector('#editEmail').value = 'test@test.com';
            modal.querySelector('#editContact').value = '1234567890';
            modal.querySelector('#editAddress').value = 'Test Address';
            
            // Show personal details
            modal.querySelector('.personalDetails').style.display = 'block';
            modal.querySelector('.corporateDetails').style.display = 'none';
            
            console.log('Modal elements:');
            console.log('Form:', modal.querySelector('#editCardForm'));
            console.log('Save button:', modal.querySelector('#editCardButton'));
            console.log('Category:', modal.querySelector('#editCardCategory'));
            
            // Add form listener
            const form = modal.querySelector('#editCardForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log('Form submit triggered!');
                    
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    data.cardId = modal.dataset.cardId;
                    
                    console.log('Form data:', data);
                    
                    try {
                        const res = await fetch('./api/update_card.php', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });
                        const result = await res.json();
                        console.log('Update result:', result);
                        
                        if (result.success) {
                            Swal.fire('Success', 'Test update successful!', 'success');
                        } else {
                            Swal.fire('Error', result.error, 'error');
                        }
                    } catch (err) {
                        console.error('Update error:', err);
                        Swal.fire('Error', err.message, 'error');
                    }
                });
            }
            
            // Add cancel button
            const cancelBtn = modal.querySelector('.cancelButton');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    modal.classList.remove('active');
                });
            }
            
        } catch (err) {
            console.error('Error loading modal:', err);
        }
    }
    </script>
</body>
</html>
